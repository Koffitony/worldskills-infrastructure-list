<div ui-tree-handle class="tree-node tree-node-content">
   <a class="btn btn-info btn-xs toggler" ng-if="item.child_items && item.child_items.length > 0" data-nodrag ng-click="toggle(this)"><span
       class="glyphicon"
       ng-class="{
         'glyphicon-menu-right': collapsed,
         'glyphicon-menu-down': !collapsed
       }"></span></a>
  {{item.description.text}}
  <!-- <span class='badge idBadge'>{{item.id}}</span> -->

  <span ng-show="activeItem == item.id">
    <!-- <small class='pull-right'>Saving...</small> -->
  </span>
  <span ng-hide="activeItem == item.id">
   <a class="pull-right btn btn-danger btn-xs" data-nodrag ng-click="removeItem(item, this);"><span
         class="glyphicon glyphicon-remove"></span></a>
   <a class="pull-right btn btn-success btn-xs" data-nodrag ng-click="newSubItem(item)" style="margin-right: 8px;"><span
         class="glyphicon glyphicon-share-alt rotate90"></span></a>
    <a class="pull-right btn btn-warning btn-xs" data-nodrag ng-click="editItem(item, $index);" style="margin-right: 8px;"><span
         class="glyphicon glyphicon-edit"></span></a>
  </span>

  <small class='pull-right'>{{getQuantity(item)}}</small>
  <small ng-if='item.supplied_item.status' class='pull-right'>
    <span class='label'
    ng-class="{'label-danger': item.supplied_item.status.id == 1,
              'label-warning': item.supplied_item.status.id == 2,
              'label-success': item.supplied_item.status.id == 3}"
    >{{item.supplied_item.status.name.text}}</span>
  </small>
  <!-- edit -->
  <div ng-if='item.id == activeItem' class='animate-if'>
    <hr class='edit-divider'/>
    <!-- <strong><small>Description</small></strong><br />
    <input class='form-control input-sm' ng-model='item.description.text'/> -->
    <form name="editForm">
  <div class='well'>
      <div class="form-group editForm has-feedback" ng-class="{'has-error': editForm.description.$error.required, 'has-success': !editForm.description.$error.required}">        
        <label class='control-label'>Description</label>
        <input name="description" type="text" class="input-sm form-control" placeholder="Description" ng-model='item.description.text' required="Description is missing" ng-required="true"  ng-trim="true">
        <span ng-if="!editForm.description.$error.required" class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>        
        <span ng-if="editForm.description.$error.required" class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>        
      </div>      
      
        <div class='row'>        
          <div class='col col-sm-12 col-md-4'>
            <div class="form-group editForm has-feedback"  ng-class="{'has-error': editForm.quantity.$error.required, 'has-success': !editForm.quantity.$error.required}">
              <label class='control-label'>Quantity</label>
              <input name="quantity" type="number" class="input-sm form-control" placeholder="Quantity" ng-model='item.quantity' required="Quantity is missing" ng-required="true">
              <span ng-if="!editForm.quantity.$error.required" class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>        
              <span ng-if="editForm.quantity.$error.required" class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>        
            </div>
          </div>
          <div class='col col-sm-12 col-md-4'>
            <div class="form-group editForm has-feedback has-success">
              <label class='control-label'>Multiplier</label>
              <!-- <select class="form-control input-sm" ng-model="item.multiplier" ng-options="multiplier.name for multiplier in multipliers track by multiplier.id"></select>             -->
              <select class="form-control input-sm" ng-model="item.multiplier" ng-options="multi.id as multi.name for multi in multipliers"></select>
            </div>
          </div>          
          <div class='col col-sm-12 col-md-4' ng-if="factorNeeded(item.multiplier)">
            <div class="form-group editForm has-feedback"  ng-class="{'has-error': editForm.multiply_factor.$error.required, 'has-success': !editForm.multiply_factor.$error.required}">
              <label class='control-label'>Multiply factor</label>
              <input name='multiply_factor' type="number" class="input-sm form-control" placeholder="X number" ng-model='item.multiply_factor' required="Multiply factor required" ng-required="true">
              <span ng-if="!editForm.multiply_factor.$error.required" class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>        
              <span ng-if="editForm.multiply_factor.$error.required" class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>        
            </div>
          </div>
        </div>
    
    <div class="form-inline">
      <div class="form-group editForm has-feedback has-success">
        <label class='sr-only'>Estimated price</label>
        <input name='price' type="number" class="input-sm form-control" ng-model="item.price" placeholder="Estimated price">
        <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>        
        
      </div>  
      <div data-nodrag class="checkbox editForm">
        <label>
          <input type="checkbox" ng-model="item.vat_refund"> VAT Refundable
        </label>
      </div>
    </div>
      
      </div>

      <div class='form-group editForm'>
        <a data-nodrag ng-disabled="editForm.$error.required" ng-click="saveItem(item, $index);" class='btn btn-sm btn-success'>Save changes</a>
        <a data-nodrag ng-click="editItem(item, $index);" class='btn btn-sm btn-warning'>cancel</a>
      </div>
      </form>
  </div>
  <!-- /edit -->
</div>
 <ol ui-tree-nodes="" ng-model="item.child_items" ng-class="{hidden: collapsed}">
   <li ng-repeat="item in item.child_items track by $id(item)" ui-tree-node ng-include="'views/item_render.html'"></li>
 </ol>